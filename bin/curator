#!/usr/bin/env php
<?php

function include_if_exists($file) {
    return file_exists($file) ? include $file : false;
}

if ((!$loader = include_if_exists(__DIR__.'/../vendor/autoload.php')) && (!$loader = include_if_exists(__DIR__.'/../../../autoload.php'))) {
    echo 'You must set up the project dependencies using `composer install`'.PHP_EOL.
        exit(1);
}

$dir = [
    'cwd' => getcwd(),
    'app' => dirname(__DIR__),
];

$definitions = [];

foreach ($dir as $directory) {
    if (file_exists("{$directory}/config/curator.php")) {
        $definitions = array_replace_recursive($definitions, include "{$directory}/config/curator.php");
    }
}

$definitions = array_replace_recursive($definitions, include "{$dir['app']}/config/services.php");

// creating lightweight DI container
$container = \Curator\Application\ContainerBuilder::build($definitions);
$container->get('Application')->run();
